<template>
	<view class="box">
		<view class="box-head" :style="{paddingTop:barHeight+'px'}">
			<nav-title-balck navTitle="选择地址"></nav-title-balck>
		</view>
		<view class="box-content">
			<mi-map ref="miMap" :lon='longitude' :lat="latitude" :isShow="isCheck" tipText="mi-Map"
				@updateAddress="updateAddress" />
		</view>
	</view>
</template>

<script>
	export default {
		data() {
			return {
				barHeight: 0, //顶部电量导航栏高度
				latitude: 24.613838,
				longitude: 118.037733,
				isCheck: false,
				markers: [{
					latitude: '',
					longitude: '',
					iconPath: '../../static/images/address-icon.png'
				}],

			}
		},

		onReady() {
			// 获取顶部电量状态栏高度
			uni.getSystemInfo({
				success: (res) => {
					this.barHeight = res.statusBarHeight
				}
			});
		},
		onLoad(options) {
			var arr = Object.keys(options.data);
			var map = JSON.parse(options.data)

			if (map.type == 'add') {
				this.isCheck = false
				// uni.showLoading({
				// 	title: '正在获取定位',
				// });
				// uni.getLocation({ // 获取位置信息
				// 	type: 'wgs84', // <map> 组件默认为国测局坐标gcj02
				// 	altitude: true,
				// 	geocode: true,
				// 	success: (res) => {
				// 		uni.hideLoading(); //隐藏登录中加载
				// 		this.longitude = res.longitude;
				// 		this.latitude = res.latitude;
				// 	},
				// 	fail(err) {
				// 		uni.showLoading({
				// 			title: '定位获取失败',
				// 		});
				// 		uni.hideLoading(); //隐藏登录中加载
				// 		console.log(err)
				// 	}
				// })
			} else {
				this.isCheck = true
				this.getAddress(map)
			}

		},
		methods: {
			// 更新地址并关闭地图
			updateAddress(addressObj) {
				this.$store.commit('upMapObj', {
					longitude: addressObj.longitude,
					latitude: addressObj.latitude,
					address: addressObj.address
				})
				uni.navigateBack({
					delta: 1
				})
			},


			getAddress(res) {
				this.longitude = res.longitude;
				this.latitude = res.latitude;
			},
		}

	}
</script>

<style lang="scss" scoped>
	.box {
		height: 100%;
		display: flex;
		flex-direction: column;

		.box-content {
			flex: 1;

		}
	}
</style>
